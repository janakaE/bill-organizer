machine:
  node:
    version: 6.9.5
  php:
    version: 7.1.0
  timezone:
    Asia/Singapore
  environment:
    BILLORG_TEST_DB_URL: mysql://homestead:secret@127.0.0.1:3306/billorg_testing
database:
  override:
    - >
      mysql -u ubuntu circle_test -e
      "CREATE DATABASE billorg_testing;
      CREATE USER 'homestead'@'%' IDENTIFIED BY 'secret';
      GRANT ALL PRIVILEGES ON *.* TO 'homestead'@'%' WITH GRANT OPTION;"
dependencies:
  pre:
    - sudo apt-get update && sudo apt-get install php5-imagick && sudo php5enmod imagick
    # - sudo apt-get --reinstall install libept1.4.12
    # - sudo apt-get install -y aptitude
    # - sudo aptitude -y install imagemagick
    # - sudo aptitude -y install libmagickcore-dev
    # - sudo aptitude -y install libmagickwand-dev
    # - sudo aptitude -y install php-imagick
  override:
    - npm install
    - composer install
    - composer update
compile:
  override:
    - npm run production
deployment:
  staging:
    branch: master
    heroku:
      appname: billorg
